# Contributing to KubeAdapt Helm Chart

This repository contains the Helm chart for deploying Kubeadapt. The chart is maintained by the KubeAdapt team and this guide outlines how users can report issues, suggest improvements, and interact with the project.

## Issue Reporting

We encourage users to report:
* Chart deployment issues
* Configuration problems
* Documentation improvements
* Dependency version updates

For product-related features or bugs, please contact authors@kubeadapt.io.

## Pull Requests

While the chart is primarily maintained by the KubeAdapt team, we review pull requests for:
* Documentation improvements
* Dependency version updates
* Bug fixes in chart templates
* Value configurations

### Pull Request Title Format

we lint the title of your pull request to ensure it follows the [conventional commits](https://www.conventionalcommits.org/) specification. this is done using github actions and the [action-semantic-pull-request](https://github.com/kubeadapt/kubeadapt-helm/blob/main/.github/workflows/pr-title.yml) workflow.

The scope of the change must be included in the title. The scope should be the name of the component you are changing. For example, if you are changing the `kubeadapt-coreapi`, the title of your pull request should be `fix(kubeadapt-coreapi): Fix typo in deployment.yaml`.

## Documentation

The documentation for each chart is generated with [helm-docs](https://github.com/norwoodj/helm-docs). This way we can ensure that values are consistent with the chart documentation.


We have a script on the repository which will execute the helm-docs docker container, so that you don't have to worry about downloading the binary etc. Simply execute the script (Bash compatible, might require sudo privileges):

```shell
./scripts/helm-docs.sh
```

> **Note**
> When creating your own `README.md.gotmpl`, don't forget to add it to your `.helmignore` file.

### Updating a chart README.md

When updating the `README.md.gotmpl` inside a chart directory you must run the helm-docs script to generate the updated `README.md` file. To reiterate, you should not edit the `README.md` file manually. It will be generated by the following command:

```shell
./scripts/helm-docs.sh
```

## Versioning

Each chart's version follows the [semver](https://semver.org/) standard.

New charts should start at version `1.0.0` if considered stable. If not stable, it must be released as prerelease.

Any breaking changes to a chart (backwards incompatible) require:
* Bump of the current Major version of the chart
* State possible manual changes for this chart version in the `Upgrading` section of the chart's `README.md.gotmpl`

### New Application Versions

Helm charts are intended to be created for all non-patch releases of KubeAdapt components (Agent and Core API). External dependencies (Prometheus and OpenCost) will use versions that have been tested with the corresponding release.

When updating application versions ensure you make the following changes:
* `values.yaml`: Bump all instances of the container image versions
* `Chart.yaml`: Ensure `appVersion` matches the KubeAdapt release version and bump chart `version`

Please ensure chart version changes adhere to semantic versioning standards:
* Major: Large chart rewrites, major non-backwards compatible or destructive changes
* Minor: New chart functionality, major application updates or minor non-backwards compatible changes
* Patch: App version patch updates, backwards compatible optional chart features

### Immutability

Each release for each chart must be immutable. Any change to a chart (even just documentation) requires a version bump. Trying to release the same version twice will result in an error.

### Artifact Hub Annotations

Since we release our charts on Artifact Hub we encourage making use of the provided chart annotations for Artifact Hub.

* [Artifact Hub Helm Annotations](https://artifacthub.io/docs/topics/annotations/helm/)


#### Changelog

We want to deliver transparent chart releases for our chart consumers. Therefore we require a changelog per new chart release.

Changes on a chart must be documented in a chart specific changelog in the `Chart.yaml` [Annotation Section](https://helm.sh/docs/topics/charts/#the-chartyaml-file).

A new `artifacthub.io/changes` needs to be written covering only the changes since the previous release.

Each change requires a new bullet point following the pattern:

```yaml
- kind: {type}
  description: {description}
```

Example:
```yaml
name: kubeadapt
version: 0.1.0
annotations:
  artifacthub.io/changes: |
    - kind: added
      description: Something New was added
    - kind: changed
      description: Changed Something within this chart
    - kind: changed
      description: Changed Something else within this chart
    - kind: deprecated
      description: Something deprecated
    - kind: removed
      description: Something was removed
    - kind: fixed
      description: Something was fixed
    - kind: security
      description: Some Security Patch was included
```

## Testing

Before reporting issues, please test with both minimal and full configurations:
```shell
# Test with default values
helm install kubeadapt ./charts/kubeadapt --dry-run

# Test with all components
helm install kubeadapt ./charts/kubeadapt \
  --set prometheus.enabled=true \
  --set opencost.enabled=true \
  --dry-run
```

### Chart Linting

We use Helm's [Chart Testing](https://github.com/helm/chart-testing) tool in CI. Configuration is in [ct-lint.yaml](./.github/configs/ct-lint.yaml).

Run linting locally:
```shell
./scripts/lint.sh
```

## Support Channels

* Chart Issues: GitHub Issues
* Product Support: authors@kubeadapt.io
* Security Issues: authors@kubeadapt.io

## Publishing

Chart releases are managed exclusively by the Kubeadapt team. All accepted changes will be included in future releases at the team's discretion. 